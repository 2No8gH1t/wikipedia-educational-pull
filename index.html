<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Educational Wikipedia</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Crimson Text', 'Times New Roman', serif;
            background-color: #2c1810;
            background-image: 
                url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E"),
                linear-gradient(to bottom, #2c1810, #3d2417);
            min-height: 100vh;
            padding: 20px;
            color: #3d2417;
            line-height: 1.7;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 40px 30px;
            background-color: #f4e4bc;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.15'/%3E%3C/svg%3E");
            border: 1px solid #5c2e0a;
            outline: 4px double #5c2e0a;
            outline-offset: -8px;
            border-radius: 4px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), inset 0 0 60px rgba(139, 69, 19, 0.2);
            position: relative;
        }

        header::before {
            content: '⚔';
            position: absolute;
            left: 25px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 28px;
            opacity: 0.8;
            color: #5c2e0a;
            text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.4);
        }

        header::after {
            content: '⚔';
            position: absolute;
            right: 25px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 28px;
            opacity: 0.8;
            color: #5c2e0a;
            text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.4);
        }

        header h1 {
            font-family: 'Cinzel', serif;
            font-size: 42px;
            margin-bottom: 12px;
            font-weight: 700;
            color: #3d1e08;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            letter-spacing: 3px;
            text-transform: uppercase;
            border-bottom: 2px solid transparent;
            display: inline-block;
            padding-bottom: 10px;
            position: relative;
        }

        header h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 2px;
            background: linear-gradient(to right, transparent, #8b4513, transparent);
        }

        .subtitle {
            font-size: 19px;
            color: #6b4423;
            font-weight: 400;
            font-style: italic;
            letter-spacing: 0.5px;
            font-family: 'Crimson Text', serif;
        }

        main {
            background-color: #faf5eb;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.5' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.12'/%3E%3C/svg%3E");
            border: 1px solid #8b4513;
            border-radius: 4px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4), inset 0 0 80px rgba(139, 69, 19, 0.08);
            position: relative;
        }
        
        main::after {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 2px solid #8b4513;
            pointer-events: none;
            border-radius: 2px;
        }

        .fetch-button {
            width: 100%;
            padding: 18px 24px;
            font-size: 20px;
            font-weight: 600;
            font-family: 'Cinzel', serif;
            color: #f9f1e0;
            background: #3d2417;
            background: linear-gradient(to bottom, #4a2c1d 0%, #2c1810 100%);
            border: 2px solid #8b4513;
            border-top-color: #5c3a28;
            border-bottom-color: #1a0e09;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 35px;
            transition: all 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            z-index: 2;
        }

        .fetch-button::before {
            content: '✦';
            font-size: 18px;
            color: #d4c19a;
        }
        
        .fetch-button::after {
            content: '✦';
            font-size: 18px;
            color: #d4c19a;
        }

        .fetch-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.15);
            background: linear-gradient(to bottom, #5c3a28 0%, #3d2417 100%);
            color: #fff;
        }

        .fetch-button:active:not(:disabled) {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3), inset 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .fetch-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loader {
            width: 18px;
            height: 18px;
            border: 3px solid rgba(244, 228, 188, 0.3);
            border-top-color: #f4e4bc;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        .article-container {
            background: transparent;
            border: none;
            border-top: 2px solid rgba(139, 69, 19, 0.2);
            padding: 20px 0 0 0;
            margin-top: 10px;
            box-shadow: none;
        }

        .article-container::before {
            display: none;
        }

        .article-header {
            margin-bottom: 30px;
            padding-bottom: 25px;
            border-bottom: 2px solid #8b4513;
            text-align: center;
        }
        
        .article-header::after {
            content: '❦';
            display: block;
            text-align: center;
            font-size: 24px;
            color: #8b4513;
            margin-top: 15px;
            opacity: 0.8;
        }

        .article-header h2 {
            font-family: 'Cinzel', serif;
            font-size: 38px;
            color: #2c1810;
            margin-bottom: 15px;
            line-height: 1.2;
            font-weight: 700;
            text-shadow: none;
        }

        .wiki-link {
            color: #8b4513;
            text-decoration: none;
            font-weight: 600;
            font-family: 'Cinzel', serif;
            font-size: 14px;
            letter-spacing: 1px;
            border-bottom: 1px solid transparent;
            text-transform: uppercase;
        }

        .wiki-link:hover {
            color: #5c2e0a;
            border-bottom: 1px solid #5c2e0a;
        }

        .article-content {
            margin-bottom: 30px;
            font-size: 18px;
            color: #2c1810;
        }

        .article-image {
            border: 5px solid #f4e4bc;
            outline: 1px solid #8b4513;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            margin: 0 0 25px 30px;
            background: #f4e4bc;
        }

        .summary-section {
            margin-bottom: 40px;
        }

        .summary-section h3 {
            font-family: 'Cinzel', serif;
            font-size: 22px;
            font-weight: 600;
            color: #5c2e0a;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(139, 69, 19, 0.3);
            padding-bottom: 8px;
            letter-spacing: 1px;
        }

        .summary-section p {
            text-align: justify;
            margin-bottom: 20px;
        }

        .article-meta {
            border-top: 1px solid rgba(139, 69, 19, 0.2);
            padding-top: 20px;
            justify-content: center;
            font-style: italic;
            opacity: 0.8;
        }

        .meta-item {
            display: flex;
            gap: 8px;
        }

        .meta-item strong {
            color: #5c2e0a;
            font-weight: 700;
        }

        .error-message {
            background: #f4e4bc;
            color: #8b0000;
            padding: 18px;
            border: 3px solid #8b0000;
            border-radius: 6px;
            margin-top: 25px;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            header {
                padding: 25px 15px;
                margin-bottom: 20px;
            }

            header::before,
            header::after {
                display: none;
            }

            header h1 {
                font-size: 28px;
            }
            
            main {
                padding: 20px;
            }
            
            .article-header h2 {
                font-size: 24px;
            }
            
            .article-image {
                float: none;
                margin: 0 0 20px 0;
                width: 100%;
                max-width: 100%;
            }
            
            .summary {
                font-size: 16px;
            }

            .summary-section h3 {
                font-size: 20px;
            }
            
            .article-meta {
                flex-direction: column;
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Random Educational Wikipedia</h1>
            <p class="subtitle">Discover complex systems, engineering, and scientific processes</p>
        </header>
        
        <main>
            <button id="fetchBtn" class="fetch-button">
                <span id="btnText">Get Random Article</span>
                <span id="btnLoader" class="loader hidden"></span>
            </button>
            
            <div id="articleContainer" class="article-container hidden">
                <div class="article-header">
                    <h2 id="articleTitle"></h2>
                    <a id="articleLink" href="#" target="_blank" class="wiki-link">
                        Read full article on Wikipedia →
                    </a>
                </div>
                
                <div class="article-content">
                    <img id="articleImage" src="" alt="" class="article-image hidden">
                    <div id="articleSummary" class="summary"></div>
                </div>
                
                <div class="article-meta">
                    <div class="meta-item">
                        <strong>Page ID:</strong> <span id="pageId"></span>
                    </div>
                    <div class="meta-item">
                        <strong>Last Modified:</strong> <span id="lastModified"></span>
                    </div>
                </div>
            </div>
            
            <div id="errorMessage" class="error-message hidden"></div>
        </main>
    </div>
    
    <script>
        const fetchBtn = document.getElementById('fetchBtn');
        const btnText = document.getElementById('btnText');
        const btnLoader = document.getElementById('btnLoader');
        const articleContainer = document.getElementById('articleContainer');
        const articleTitle = document.getElementById('articleTitle');
        const articleLink = document.getElementById('articleLink');
        const articleImage = document.getElementById('articleImage');
        const articleSummary = document.getElementById('articleSummary');
        const pageId = document.getElementById('pageId');
        const lastModified = document.getElementById('lastModified');
        const errorMessage = document.getElementById('errorMessage');

        // List of high-level educational categories focused on science, engineering, and complex systems
        const educationalCategories = [
            'Innovation',
            'Manufacturing',
            'Engineering',
            'Technology',
            'Science',
            'Chemistry',
            'Physics',
            'Biology',
            'Mathematics',
            'Architecture',
            'Metallurgy',
            'Computer Science',
            'Mechanical Engineering',
            'Electrical Engineering',
            'Civil Engineering',
            'Chemical Engineering',
            'Materials Science',
            'Nanotechnology',
            'Biotechnology',
            'Genetics',
            'Archaeology',
            'Paleontology',
            'Geology',
            'Astronomy',
            'Astrophysics',
            'Oceanography',
            'Meteorology',
            'Environmental Science',
            'Economics',
            'Philosophy',
            'Linguistics',
            'Psychology',
            'Sociology',
            'Anthropology',
            'Medicine',
            'Epidemiology',
            'Law',
            'Military History',
            'System',
            'Methodology',
            'Epistemology',
            'Thermodynamics',
            'Quantum Mechanics',
            'Cybernetics',
            'Logic',
            'Ethics'
        ];

        let attemptCount = 0;
        const maxAttempts = 5; // Allow more retries to find high-level articles

        async function fetchRandomArticle() {
            // Show loading state
            fetchBtn.disabled = true;
            btnText.textContent = 'Loading...';
            btnLoader.classList.remove('hidden');
            articleContainer.classList.add('hidden');
            errorMessage.classList.add('hidden');
            
            try {
                // Use Wikipedia's REST API to get a random article
                // The /page/random/summary endpoint returns a random article with summary
                const response = await fetch('https://en.wikipedia.org/api/rest_v1/page/random/summary');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Check if the article seems educational (more lenient filter)
                const shouldReject = checkIfEducational(data);
                
                // Only retry once if we should reject, otherwise show immediately
                if (shouldReject && attemptCount < maxAttempts) {
                    attemptCount++;
                    return fetchRandomArticle();
                }
                
                attemptCount = 0;
                
                // Fetch additional content for a longer summary
                try {
                    const extendedContent = await fetchExtendedContent(data.title, data.pageid);
                    if (extendedContent && extendedContent.length > data.extract.length) {
                        data.extract = extendedContent;
                    }
                } catch (extError) {
                    console.log('Could not fetch extended content, using summary:', extError);
                    // Continue with original extract if extended fetch fails
                }
                
                // Display the article
                displayArticle(data);
                
            } catch (error) {
                console.error('Error fetching article:', error);
                errorMessage.textContent = `Error loading article: ${error.message}. Please try again.`;
                errorMessage.classList.remove('hidden');
            } finally {
                // Reset button state
                fetchBtn.disabled = false;
                btnText.textContent = 'Get Random Article';
                btnLoader.classList.add('hidden');
            }
        }

        async function fetchExtendedContent(title, pageid) {
            // Try multiple approaches to get the most comprehensive content
            
            // Approach 1: Try Wikipedia REST API HTML endpoint for full content
            try {
                const encodedTitle = encodeURIComponent(title);
                const htmlUrl = `https://en.wikipedia.org/api/rest_v1/page/html/${encodedTitle}`;
                const htmlResponse = await fetch(htmlUrl);
                
                if (htmlResponse.ok) {
                    const html = await htmlResponse.text();
                    // Parse HTML to extract text content from all sections
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    // Remove navigation, references, and other non-content elements
                    const toRemove = doc.querySelectorAll('nav, .reference, .mw-references-wrap, .navbox, .infobox, .thumb, .mw-editsection, .mw-cite-backlink');
                    toRemove.forEach(el => el.remove());
                    
                    // Get all paragraph content from all sections
                    // Get main content area
                    const mainContent = doc.querySelector('body') || doc;
                    
                    // Get all paragraphs, including those in sections
                    const allParagraphs = Array.from(mainContent.querySelectorAll('p'))
                        .map(p => {
                            // Get text content, handling nested elements
                            let text = p.textContent.trim();
                            // Remove citation numbers like [1], [2], etc.
                            text = text.replace(/\[\d+\]/g, '');
                            return text;
                        })
                        .filter(text => text.length > 50 && !text.match(/^\[edit\]$/i)) // Filter out very short paragraphs and edit links
                        .filter((text, index, arr) => arr.indexOf(text) === index); // Remove duplicates
                    
                    const fullContent = allParagraphs.join('\n\n');
                    
                    if (fullContent && fullContent.length > 1000) {
                        return fullContent;
                    }
                }
            } catch (htmlError) {
                console.log('HTML fetch failed, trying extract API:', htmlError);
            }
            
            // Approach 2: Use MediaWiki API with maximum extract settings
            // Try to get as much content as possible
            const mwApiUrl = `https://en.wikipedia.org/w/api.php?action=query&format=json&pageids=${pageid}&prop=extracts&exintro=false&explaintext=true&exsectionformat=plain&exlimit=max&origin=*`;
            
            try {
                const mwResponse = await fetch(mwApiUrl);
                if (!mwResponse.ok) {
                    throw new Error('MediaWiki API request failed');
                }
                
                const mwData = await mwResponse.json();
                if (mwData.query && mwData.query.pages && mwData.query.pages[pageid]) {
                    const extract = mwData.query.pages[pageid].extract;
                    if (extract && extract.trim().length > 0) {
                        return extract;
                    }
                }
            } catch (error) {
                console.log('Error fetching extended content:', error);
            }
            
            return null;
        }

        function checkIfEducational(data) {
            // Check if article is about high-level creation, manufacturing, or processes
            const text = (data.title + ' ' + (data.extract || '')).toLowerCase();
            
            // Only reject if it's clearly not educational (disambiguation, very short, etc.)
            const rejectPatterns = [
                'disambiguation',
                'list of',
                'category:',
                'template:',
                'file:',
                'user:',
                'wikipedia:',
                'help:'
            ];
            
            // Reject if title matches reject patterns
            const shouldReject = rejectPatterns.some(pattern => 
                data.title.toLowerCase().includes(pattern)
            );
            
            // Reject if extract is too short - High level content is usually longer
            // Increased from 100 to 400 characters to ensure substance
            const isTooShort = !data.extract || data.extract.length < 400;
            
            // Reject biographical articles about specific individuals
            const isBiographical = checkIfBiographical(data);
            
            // Check for complexity/high-level markers
            const isHighLevel = checkIfHighLevel(data);
            
            // Prefer articles about creation, manufacturing, processes, and how things work
            const isAboutCreation = checkIfAboutCreation(data);
            
            // Reject logic:
            // 1. Reject standard patterns (disambiguation, etc.)
            // 2. Reject if too short (stubs)
            // 3. Reject if biographical (unless it's a key creator of a system/process, but we filter strictly now)
            // 4. Reject if not "high level" enough (simple topics)
            
            if (shouldReject || (isTooShort && attemptCount < 2) || isBiographical) {
                return true;
            }
            
            // If it's about creation/processes OR it's high-level academic, we accept it
            // But if it lacks complexity markers, we might skip it in early attempts
            if (!isHighLevel && !isAboutCreation && attemptCount < 1) {
                return true;
            }
            
            return false;
        }
        
        function checkIfHighLevel(data) {
            const text = (data.title + ' ' + (data.extract || '')).toLowerCase();
            
            // Keywords indicating academic/technical/systemic complexity
            const complexityKeywords = [
                'theory', 'principle', 'mechanism', 'system', 'structure',
                'analysis', 'concept', 'development', 'evolution', 'phenomenon',
                'methodology', 'classification', 'taxonomy', 'equation', 'theorem',
                'algorithm', 'infrastructure', 'framework', 'hypothesis', 'synthesis',
                'thermodynamics', 'mechanics', 'quantum', 'relativity', 'molecular',
                'genetic', 'computational', 'archaeological', 'sociological', 'economic',
                'philosophical', 'paradigm', 'spectrum', 'dimension', 'velocity',
                'magnitude', 'equilibrium', 'correlation', 'variable', 'function',
                'derivative', 'integral', 'optimization', 'protocol', 'architecture',
                'epistemology', 'historiography', 'cybernetics', 'macroeconomics',
                'microeconomics', 'geopolitics', 'jurisprudence', 'criminology',
                'neurology', 'pathology', 'immunology', 'seismology', 'cosmology'
            ];
            
            // Check for at least one complexity keyword
            const hasComplexity = complexityKeywords.some(keyword => text.includes(keyword));
            
            return hasComplexity;
        }

        function checkIfBiographical(data) {
            // Check if the article is about a specific individual (biography)
            const title = data.title;
            const extract = (data.extract || '').toLowerCase();
            const fullText = (title + ' ' + extract).toLowerCase();
            
            // Biographical indicators in the content
            const biographicalIndicators = [
                'was born',
                'was an',
                'is an',
                'is a',
                'born in',
                'died in',
                'died on',
                'lived from',
                'was a',
                'is known for',
                'was known for',
                'was the',
                'is the',
                'served as',
                'worked as',
                'attended',
                'graduated from',
                'married',
                'had children',
                'was married to',
                'was the son of',
                'was the daughter of',
                'was born to',
                'grew up in',
                'studied at',
                'received',
                'won the',
                'awarded',
                'career',
                'early life',
                'personal life',
                'later life',
                'death',
                'legacy'
            ];
            
            // Check if extract contains multiple biographical indicators (likely a biography)
            const biographicalCount = biographicalIndicators.filter(indicator => 
                extract.includes(indicator)
            ).length;
            
            // If 3 or more biographical indicators, it's likely a biography
            if (biographicalCount >= 3) {
                return true;
            }
            
            // Check if title looks like a person's name (First Last format, but not common phrases)
            // Simple heuristic: if title has 2-4 words and extract starts with biographical language
            const titleWords = title.split(' ').filter(w => w.length > 0);
            const looksLikeName = titleWords.length >= 2 && titleWords.length <= 4;
            
            // If it looks like a name AND has biographical content, reject it
            if (looksLikeName && biographicalCount >= 2) {
                return true;
            }
            
            // Check for very strong biographical opening (most biographies start this way)
            const strongBiographicalStart = extract.match(/^(was|is|born|died|lived|served|worked|studied|received|won|awarded)/);
            if (strongBiographicalStart && looksLikeName) {
                return true;
            }
            
            return false;
        }

        function checkIfAboutCreation(data) {
            // Check if the article is about creation, manufacturing, processes, or how things are made
            const title = data.title.toLowerCase();
            const extract = (data.extract || '').toLowerCase();
            const fullText = (title + ' ' + extract).toLowerCase();
            
            // Keywords related to creation, manufacturing, and processes
            const creationKeywords = [
                'manufactured',
                'constructed',
                'engineered',
                'synthesized',
                'fabricated',
                'assembly',
                'production process',
                'manufacturing process',
                'fabrication technique',
                'construction method',
                'synthesis of',
                'preparation of',
                'algorithm for',
                'mechanism of',
                'protocol for',
                'procedure for',
                'methodology',
                'system architecture',
                'design pattern'
            ];
            
            // Count how many creation-related keywords appear
            const creationCount = creationKeywords.filter(keyword => 
                fullText.includes(keyword)
            ).length;
            
            // If 1 or more strict creation keywords, it's likely about creation/processes
            if (creationCount >= 1) {
                return true;
            }
            
            // Check title for creation-related terms
            const titleCreationTerms = [
                'manufacturing',
                'production',
                'process',
                'technique',
                'method',
                'construction',
                'synthesis',
                'algorithm',
                'protocol',
                'mechanism'
            ];
            
            const titleHasCreationTerm = titleCreationTerms.some(term => 
                title.includes(term)
            );
            
            if (titleHasCreationTerm) {
                return true;
            }
            
            return false;
        }

        function formatSummaryAsResearchArticle(paragraphs, container, isCreation, isHighLevel) {
            if (paragraphs.length === 0) return;
            
            // Introduction Section - State what the topic is and why it's interesting
            const introSection = document.createElement('div');
            introSection.className = 'summary-section';
            const introH3 = document.createElement('h3');
            introH3.textContent = 'Introduction';
            introSection.appendChild(introH3);
            
            const introP = document.createElement('p');
            introP.textContent = paragraphs[0].trim();
            introSection.appendChild(introP);
            container.appendChild(introSection);
            
            // If there's only one paragraph, we're done
            if (paragraphs.length === 1) return;
            
            // Remaining paragraphs organized into research article sections
            // Since we limit to 4 paragraphs max, we'll have at most 3 remaining
            let remainingParagraphs = paragraphs.slice(1);
            
            // Define headers based on content type
            let headers = [];
            
            if (isCreation) {
                headers = [
                    'How It Is Made or Created',
                    'Materials, Techniques, and Process Details',
                    'Historical Development and Significance'
                ];
            } else {
                // Default for concepts/theories
                headers = [
                    'Core Concepts and Methodology',
                    'Analysis and Theoretical Framework',
                    'Implications and Significance'
                ];
            }

            if (remainingParagraphs.length >= 1) {
                const methodSection = document.createElement('div');
                methodSection.className = 'summary-section';
                const methodH3 = document.createElement('h3');
                methodH3.textContent = headers[0];
                methodSection.appendChild(methodH3);
                const methodP = document.createElement('p');
                methodP.textContent = remainingParagraphs[0].trim();
                methodSection.appendChild(methodP);
                container.appendChild(methodSection);
            }
            
            if (remainingParagraphs.length >= 2) {
                const resultsSection = document.createElement('div');
                resultsSection.className = 'summary-section';
                const resultsH3 = document.createElement('h3');
                resultsH3.textContent = headers[1];
                resultsSection.appendChild(resultsH3);
                const resultsP = document.createElement('p');
                resultsP.textContent = remainingParagraphs[1].trim();
                resultsSection.appendChild(resultsP);
                container.appendChild(resultsSection);
            }
            
            if (remainingParagraphs.length >= 3) {
                const discussionSection = document.createElement('div');
                discussionSection.className = 'summary-section';
                const discussionH3 = document.createElement('h3');
                discussionH3.textContent = headers[2];
                discussionSection.appendChild(discussionH3);
                const discussionP = document.createElement('p');
                discussionP.textContent = remainingParagraphs[2].trim();
                discussionSection.appendChild(discussionP);
                container.appendChild(discussionSection);
            }
        }

        function displayArticle(data) {
            // Set title
            articleTitle.textContent = data.title;
            
            // Set Wikipedia link
            if (data.content_urls && data.content_urls.desktop) {
                articleLink.href = data.content_urls.desktop.page;
            } else {
                articleLink.href = `https://en.wikipedia.org/wiki/${encodeURIComponent(data.title)}`;
            }
            
            // Set image if available
            if (data.thumbnail && data.thumbnail.source) {
                articleImage.src = data.thumbnail.source;
                articleImage.alt = data.title;
                articleImage.classList.remove('hidden');
            } else {
                articleImage.classList.add('hidden');
            }
            
            // Set summary with proper research article format
            if (data.extract) {
                // Split by double newlines to preserve paragraphs, but also handle section headers
                // Wikipedia sections often have headers like "== Section Name =="
                let content = data.extract;
                
                // Split into paragraphs, preserving section structure
                let paragraphs = content.split('\n\n').filter(p => p.trim().length > 0);
                
                // Limit to maximum 4 paragraphs for a shorter, more concise summary
                paragraphs = paragraphs.slice(0, 4);
                
                // Clear previous content
                articleSummary.innerHTML = '';
                
                // Format the summary following research article structure with more depth
                // Determine content type for headers
                const isCreation = checkIfAboutCreation(data);
                const isHighLevel = checkIfHighLevel(data);
                formatSummaryAsResearchArticle(paragraphs, articleSummary, isCreation, isHighLevel);
            } else {
                articleSummary.innerHTML = '<p>No summary available for this article.</p>';
            }
            
            // Set metadata
            if (data.pageid) {
                pageId.textContent = data.pageid;
            }
            
            if (data.timestamp) {
                const date = new Date(data.timestamp);
                lastModified.textContent = date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }
            
            // Show article container
            articleContainer.classList.remove('hidden');
            
            // Scroll to article
            articleContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Event listener
        fetchBtn.addEventListener('click', fetchRandomArticle);

        // Fetch an article on page load
        window.addEventListener('load', () => {
            fetchRandomArticle();
        });
    </script>
</body>
</html>

